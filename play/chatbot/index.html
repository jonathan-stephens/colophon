<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ethics AI Assistant</title>
  <style>
  /* CSS Reset & Base Styles */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    /* Color Tokens - Light Theme (Default) */
    --color-bg: #ffffff;
    --color-surface: #f7f7f8;
    --color-surface-secondary: #ececf1;
    --color-border: #e5e5e5;
    --color-border-hover: #d1d1d6;
    --color-text-primary: #202123;
    --color-text-secondary: #6e6e80;
    --color-text-tertiary: #8e8ea0;
    --color-accent: #19c37d;
    --color-accent-hover: #1a9c65;
    --color-accent-light: rgba(25,195,125,0.1);
    --color-card-bg: #ffffff;
    --color-card-hover: #f7f7f8;
    --color-message-user: #19c37d;
    --color-message-assistant: #f7f7f8;
    --color-shadow: rgba(0,0,0,0.1);
    --color-overlay: rgba(0,0,0,0.5);

    /* Spacing Scale */
    --spacing-xs: 0.5rem;
    --spacing-sm: 0.75rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;

    /* Layout */
    --header-height: 3.5rem;
    --sidebar-width: 16rem;
    --max-content-width: 48rem;

    /* Typography */
    --font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Noto Sans", sans-serif;
    --font-size-xs: 0.75rem;
    --font-size-sm: 0.875rem;
    --font-size-base: 1rem;
    --font-size-lg: 1.125rem;
    --font-size-xl: 1.25rem;
    --font-size-2xl: 1.5rem;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;
    --line-height-tight: 1.25;
    --line-height-normal: 1.5;
    --line-height-relaxed: 1.6;

    /* Border Radius */
    --radius-sm: 0.25rem;
    --radius-md: 0.375rem;
    --radius-lg: 0.5rem;
    --radius-xl: 0.75rem;
    --radius-2xl: 1rem;
    --radius-full: 9999px;

    /* Transitions */
    --transition-speed: 0.2s;
    --transition-timing: ease-in-out;

    /* Shadows */
    --shadow-sm: 0 1px 2px 0 var(--color-shadow);
    --shadow-md: 0 4px 6px -1px var(--color-shadow);
    --shadow-lg: 0 10px 15px -3px var(--color-shadow);
    --shadow-xl: 0 20px 25px -5px var(--color-shadow);
  }

  /* Dark Theme */
  [data-theme="dark"] {
    --color-bg: #1a1a1a;
    --color-surface: #2d2d2d;
    --color-surface-secondary: #3d3d3d;
    --color-border: #404040;
    --color-border-hover: #525252;
    --color-text-primary: #ececf1;
    --color-text-secondary: #b4b4b4;
    --color-text-tertiary: #8e8ea0;
    --color-accent: #10a37f;
    --color-accent-hover: #0e8c6f;
    --color-accent-light: rgba(16,163,127,0.15);
    --color-card-bg: #2d2d2d;
    --color-card-hover: #3d3d3d;
    --color-message-user: #10a37f;
    --color-message-assistant: #2d2d2d;
    --color-shadow: rgba(0,0,0,0.3);
    --color-overlay: rgba(0,0,0,0.7);
  }

  /* High Contrast Theme */
  [data-theme="high-contrast"] {
    --color-bg: #000000;
    --color-surface: #1a1a1a;
    --color-surface-secondary: #2d2d2d;
    --color-border: #ffffff;
    --color-border-hover: #ffffff;
    --color-text-primary: #ffffff;
    --color-text-secondary: #ffffff;
    --color-text-tertiary: #e0e0e0;
    --color-accent: #00ff00;
    --color-accent-hover: #00dd00;
    --color-accent-light: rgba(0,255,0,0.2);
    --color-card-bg: #1a1a1a;
    --color-card-hover: #2d2d2d;
    --color-message-user: #00ff00;
    --color-message-assistant: #1a1a1a;
    --color-shadow: rgba(255,255,255,0.2);
    --color-overlay: rgba(0,0,0,0.9);
  }

  /* Blue Theme */
  [data-theme="blue"] {
    --color-bg: #f0f4f8;
    --color-surface: #dbe7f0;
    --color-surface-secondary: #c8d9e6;
    --color-border: #b8cfe0;
    --color-border-hover: #a0c4d9;
    --color-text-primary: #1a2332;
    --color-text-secondary: #4a5568;
    --color-text-tertiary: #718096;
    --color-accent: #3182ce;
    --color-accent-hover: #2c5aa0;
    --color-accent-light: rgba(49,130,206,0.1);
    --color-card-bg: #ffffff;
    --color-card-hover: #edf2f7;
    --color-message-user: #3182ce;
    --color-message-assistant: #edf2f7;
    --color-shadow: rgba(49,130,206,0.15);
    --color-overlay: rgba(26,35,50,0.5);
  }

  body {
    font-family: var(--font-family);
    line-height: var(--line-height-relaxed);
    color: var(--color-text-primary);
    background: var(--color-bg);
    min-height: 100vh;
    overflow-x: hidden;
    transition: background var(--transition-speed) var(--transition-timing),
                color var(--transition-speed) var(--transition-timing);
  }

  /* Skip Link */
  .skip-link {
    position: absolute;
    top: -100%;
    left: 0;
    background: var(--color-accent);
    color: white;
    padding: var(--spacing-sm) var(--spacing-md);
    text-decoration: none;
    z-index: 10000;
  }

  .skip-link:focus {
    top: 0;
  }

  /* Theme Selector */
  .theme-selector {
    position: fixed;
    top: var(--spacing-md);
    right: var(--spacing-md);
    z-index: 10001;
  }

  .theme-select {
    padding: var(--spacing-xs) var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-surface);
    color: var(--color-text-primary);
    font-size: var(--font-size-sm);
    cursor: pointer;
    font-family: var(--font-family);
  }

  /* Layout Container */
  .app-container {
    display: flex;
    min-height: 100vh;
  }

  /* Sidebar Navigation */
  .sidebar {
    background: var(--color-surface);
    border-right: 1px solid var(--color-border);
    display: flex;
    flex-direction: column;
    height: 100vh;
    position: sticky;
    top: 0;
    transition: width var(--transition-speed) var(--transition-timing);
    overflow: hidden;
    flex-shrink: 0;
  }

  .sidebar[data-open="false"] {
    width: 4rem;
  }

  .sidebar[data-open="true"] {
    width: var(--sidebar-width);
  }

  .sidebar-header {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
    flex-shrink: 0;
  }

  .sidebar-toggle-btn {
    background: none;
    border: none;
    padding: var(--spacing-xs);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 4px;
    width: 2rem;
    height: 2rem;
    justify-content: center;
    align-items: flex-start;
    border-radius: var(--radius-md);
    transition: background var(--transition-speed) var(--transition-timing);
  }

  .sidebar-toggle-btn:hover,
  .sidebar-toggle-btn:focus {
    background: var(--color-card-hover);
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .sidebar-toggle-line {
    height: 2px;
    background: var(--color-text-primary);
    border-radius: 2px;
    transition: all var(--transition-speed) var(--transition-timing);
  }

  .sidebar-toggle-line:nth-child(1) { width: 100%; }
  .sidebar-toggle-line:nth-child(2) { width: 75%; }
  .sidebar-toggle-line:nth-child(3) { width: 50%; }

  .sidebar-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .nav-list {
    list-style: none;
    padding: var(--spacing-sm);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .nav-item {
    width: 100%;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-sm);
    color: var(--color-text-primary);
    text-decoration: none;
    border-radius: var(--radius-md);
    transition: background var(--transition-speed) var(--transition-timing);
    white-space: nowrap;
    min-height: 2.5rem;
  }

  .nav-link:hover,
  .nav-link:focus {
    background: var(--color-card-hover);
  }

  .nav-icon {
    width: 1.5rem;
    height: 1.5rem;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nav-label {
    opacity: 1;
    transition: opacity var(--transition-speed) var(--transition-timing);
  }

  .sidebar[data-open="false"] .nav-label {
    opacity: 0;
    width: 0;
    overflow: hidden;
  }

  /* Main Content Area */
  .main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    min-width: 0;
  }

  /* Header */
  .header {
    height: var(--header-height);
    background: var(--color-bg);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 var(--spacing-md);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-lg);
  }

  .beta-badge {
    font-size: var(--font-size-xs);
    padding: 0.125rem 0.375rem;
    background: var(--color-text-secondary);
    color: var(--color-bg);
    border-radius: var(--radius-sm);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Chat Container */
  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: var(--spacing-xl) var(--spacing-md);
  }

  /* Prompt Header */
  .prompt-header {
    text-align: center;
    margin-bottom: var(--spacing-xl);
    max-width: var(--max-content-width);
    margin-left: auto;
    margin-right: auto;
    width: 100%;
  }

  .prompt-text {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-primary);
  }

  /* Starter Cards Grid */
  .starter-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-md);
    max-width: var(--max-content-width);
    margin: 0 auto;
    width: 100%;
  }

  .starter-card {
    background: var(--color-card-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-lg);
    cursor: pointer;
    transition: all var(--transition-speed) var(--transition-timing);
    text-align: left;
  }

  .starter-card:hover,
  .starter-card:focus {
    background: var(--color-card-hover);
    border-color: var(--color-accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .starter-card:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .card-title {
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--spacing-xs);
    color: var(--color-text-primary);
  }

  .card-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: var(--line-height-normal);
  }

  /* Messages Area */
  .messages-area {
    flex: 1;
    max-width: var(--max-content-width);
    margin: 0 auto;
    width: 100%;
    display: none;
  }

  .messages-area[data-active="true"] {
    display: block;
  }

  .message {
    margin-bottom: var(--spacing-xl);
    animation: fadeIn 0.3s ease-in;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .message-user {
    text-align: right;
  }

  .message-bubble {
    display: inline-block;
    padding: var(--spacing-md);
    border-radius: var(--radius-2xl);
    max-width: 85%;
  }

  .message-user .message-bubble {
    background: var(--color-message-user);
    color: var(--color-bg);
  }

  .message-assistant .message-content {
    background: var(--color-message-assistant);
    padding: var(--spacing-lg);
    border-radius: var(--radius-xl);
  }

  /* Citations */
  .citations {
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
  }

  .citations-title {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-sm);
    margin-bottom: var(--spacing-sm);
    color: var(--color-text-secondary);
  }

  .citations-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .citation-link {
    color: var(--color-accent);
    text-decoration: none;
    font-size: var(--font-size-sm);
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    transition: color var(--transition-speed) var(--transition-timing);
  }

  .citation-link:hover,
  .citation-link:focus {
    text-decoration: underline;
    color: var(--color-accent-hover);
  }

  /* Follow-up Questions */
  .followup-questions {
    margin-top: var(--spacing-lg);
  }

  .followup-title {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-sm);
    margin-bottom: var(--spacing-sm);
    color: var(--color-text-secondary);
  }

  .followup-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .followup-btn {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-lg);
    cursor: pointer;
    text-align: left;
    font-size: var(--font-size-sm);
    transition: all var(--transition-speed) var(--transition-timing);
    width: 100%;
    color: var(--color-text-primary);
  }

  .followup-btn:hover,
  .followup-btn:focus {
    background: var(--color-card-hover);
    border-color: var(--color-accent);
  }

  /* Input Area */
  .input-area {
    border-top: 1px solid var(--color-border);
    padding: var(--spacing-md);
    background: var(--color-bg);
    position: sticky;
    bottom: 0;
  }

  .input-container {
    max-width: var(--max-content-width);
    margin: 0 auto;
    display: flex;
    gap: var(--spacing-sm);
    align-items: flex-end;
  }

  .input-wrapper {
    flex: 1;
    position: relative;
  }

  .message-input {
    width: 100%;
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    font-family: inherit;
    font-size: var(--font-size-base);
    resize: none;
    max-height: 200px;
    min-height: 3rem;
    background: var(--color-bg);
    color: var(--color-text-primary);
    transition: border-color var(--transition-speed) var(--transition-timing),
                outline var(--transition-speed) var(--transition-timing);
  }

  .message-input:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: -1px;
    border-color: transparent;
  }

  .send-btn {
    background: var(--color-accent);
    color: var(--color-bg);
    border: none;
    padding: var(--spacing-md);
    border-radius: var(--radius-xl);
    cursor: pointer;
    transition: background var(--transition-speed) var(--transition-timing);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 3rem;
    height: 3rem;
  }

  .send-btn:hover:not(:disabled),
  .send-btn:focus:not(:disabled) {
    background: var(--color-accent-hover);
  }

  .send-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Visible status indicator */
  .status-indicator {
    display: inline-block;
    margin-left: 0.5rem;
    font-size: 0.9rem;
    color: var(--color-text-secondary);
  }

  /* Visually Hidden */
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    margin: -1px;
    padding: 0;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
  }

  /* Responsive */
  @media (min-width: 768px) {
    .chat-container {
      padding: var(--spacing-xl);
    }

    .starter-cards {
      grid-template-columns: repeat(2, 1fr);
    }

    .prompt-text {
      font-size: var(--font-size-2xl);
    }
  }

  @media (max-width: 767px) {
    .sidebar[data-open="false"] {
      width: 0;
      border-right: none;
    }

    .sidebar[data-open="true"] {
      width: 16rem;
    }
  }

  @media (prefers-color-scheme: dark) {
    :root:not([data-theme]) {
      --color-bg: #1a1a1a;
      --color-surface: #2d2d2d;
      --color-surface-secondary: #3d3d3d;
      --color-border: #404040;
      --color-border-hover: #525252;
      --color-text-primary: #ececf1;
      --color-text-secondary: #b4b4b4;
      --color-text-tertiary: #8e8ea0;
      --color-accent: #10a37f;
      --color-accent-hover: #0e8c6f;
      --color-accent-light: rgba(16, 163, 127, 0.15);
      --color-card-bg: #2d2d2d;
      --color-card-hover: #3d3d3d;
      --color-message-user: #10a37f;
      --color-message-assistant: #2d2d2d;
      --color-shadow: rgba(0, 0, 0, 0.3);
      --color-overlay: rgba(0, 0, 0, 0.7);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Theme Switcher (visible, preserved from original) -->
  <div class="theme-selector">
    <label for="theme-select" class="visually-hidden">Select theme</label>
    <select id="theme-select" class="theme-select" aria-label="Theme selector">
      <option value="">Auto (System)</option>
      <option value="light">Light</option>
      <option value="dark">Dark</option>
      <option value="high-contrast">High Contrast</option>
      <option value="blue">Blue</option>
      <option value="warm">Warm</option>
      <option value="purple">Purple</option>
    </select>
  </div>

  <div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar" data-open="false" aria-label="Main navigation">
      <div class="sidebar-header">
        <button
          class="sidebar-toggle-btn"
          id="sidebar-toggle-btn"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="sidebar-content"
        >
          <span class="sidebar-toggle-line"></span>
          <span class="sidebar-toggle-line"></span>
          <span class="sidebar-toggle-line"></span>
        </button>
      </div>
      <div class="sidebar-content" id="sidebar-content">
        <h2 class="visually-hidden">Navigation Menu</h2>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="#" class="nav-link" role="button" aria-label="New chat">
              <span class="nav-icon" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </span>
              <span class="nav-label">New Chat</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" role="button" aria-label="Home">
              <span class="nav-icon" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                  <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
              </span>
              <span class="nav-label">Home</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" role="button" aria-label="History">
              <span class="nav-icon" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h18v18H3zM21 9H3M9 21V9"/>
                </svg>
              </span>
              <span class="nav-label">History</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" role="button" aria-label="Settings">
              <span class="nav-icon" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24m-12.72 0l4.24-4.24m4.24-4.24l4.24-4.24"/>
                </svg>
              </span>
              <span class="nav-label">Settings</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" role="button" aria-label="Help and FAQ">
              <span class="nav-icon" aria-hidden="true">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 16v-4m0-4h.01"/>
                </svg>
              </span>
              <span class="nav-label">Help & FAQ</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" role="main">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <span>Ethics AI</span>
          <span class="beta-badge" aria-label="Beta version">Beta</span>
        </div>
      </header>

      <!-- Chat Container -->
      <div class="chat-container" id="main-content">
        <!-- Prompt Header -->
        <div class="prompt-header" id="prompt-header">
          <h1 class="prompt-text">What ethics related questions can I help answer?</h1>
        </div>

        <!-- Starter Cards -->
        <div class="starter-cards" id="starter-cards">
          <button class="starter-card" data-question="How do I handle a conflict of interest at work?">
            <h2 class="card-title">Conflict of Interest</h2>
            <p class="card-description">How do I handle a conflict of interest at work?</p>
          </button>

          <button class="starter-card" data-question="What are the ethical implications of AI in healthcare?">
            <h2 class="card-title">AI Ethics</h2>
            <p class="card-description">What are the ethical implications of AI in healthcare?</p>
          </button>

          <button class="starter-card" data-question="How should I approach whistleblowing?">
            <h2 class="card-title">Whistleblowing</h2>
            <p class="card-description">How should I approach whistleblowing?</p>
          </button>

          <button class="starter-card" data-question="What is the difference between ethics and compliance?">
            <h2 class="card-title">Ethics vs Compliance</h2>
            <p class="card-description">What is the difference between ethics and compliance?</p>
          </button>
        </div>

        <!-- Messages Area (initially hidden) -->
        <div class="messages-area" id="messages-area" role="log" aria-live="polite" aria-atomic="false" aria-relevant="additions text" aria-label="Conversation messages">
          <!-- Messages will be dynamically inserted here -->
        </div>
      </div>

      <!-- Input Area -->
      <div class="input-area">
        <form class="input-container" id="chat-form" aria-label="Send message">
          <div class="input-wrapper">
            <label for="message-input" class="visually-hidden">Type your message</label>
            <textarea
              id="message-input"
              class="message-input"
              placeholder="Ask a follow-up question..."
              rows="1"
              aria-label="Message input"
              aria-describedby="bot-status"
            ></textarea>
          </div>
          <button type="submit" class="send-btn" id="send-btn" aria-label="Send message" disabled>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M2.5 10L17.5 3.75L11.25 18.75L10 12.5L2.5 10Z" fill="currentColor"/>
            </svg>
          </button>
          <!-- Visible status for sighted users + visually-hidden live region for AT -->
          <div id="bot-status" class="status-indicator" aria-hidden="true" style="display:none">Bot is generating response…</div>
        </form>
      </div>
    </main>
  </div>

  <!-- Screen-reader-only status (announces to assistive tech) -->
  <div id="sr-status" class="visually-hidden" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function () {
      // Elements
      const htmlEl = document.documentElement;
      const themeSelect = document.getElementById('theme-select');
      const sidebar = document.getElementById('sidebar');
      const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
      const chatForm = document.getElementById('chat-form');
      const messageInput = document.getElementById('message-input');
      const sendBtn = document.getElementById('send-btn');
      const messagesArea = document.getElementById('messages-area');
      const starterCards = document.getElementById('starter-cards');
      const promptHeader = document.getElementById('prompt-header');
      const botStatusVisible = document.getElementById('bot-status');
      const srStatus = document.getElementById('sr-status');

      // Respect user/system preferences
      const prefersDarkMQ = window.matchMedia('(prefers-color-scheme: dark)');
      const prefersReducedMotionMQ = window.matchMedia('(prefers-reduced-motion: reduce)');
      const prefersContrastMQ = window.matchMedia('(prefers-contrast: more)');

      function applyTheme(theme) {
        if (theme) {
          htmlEl.setAttribute('data-theme', theme);
        } else {
          htmlEl.removeAttribute('data-theme');
        }
        try { localStorage.setItem('chat-theme', theme || ''); } catch (e) { /* ignore */ }
      }

      function loadTheme() {
        const saved = localStorage.getItem('chat-theme');
        if (saved) {
          if (themeSelect) themeSelect.value = saved;
          applyTheme(saved);
        } else {
          // set default from system
          applyTheme(prefersDarkMQ.matches ? 'dark' : '');
        }
        // If user prefers high contrast and no explicit choice, apply it
        if (prefersContrastMQ.matches && !htmlEl.hasAttribute('data-theme')) {
          applyTheme('high-contrast');
          if (themeSelect) themeSelect.value = 'high-contrast';
        }
      }

      if (themeSelect) {
        themeSelect.addEventListener('change', (e) => applyTheme(e.target.value || ''));
        // Keep in sync with system if user hasn't explicitly chosen
        prefersDarkMQ.addEventListener('change', (e) => {
          const saved = localStorage.getItem('chat-theme');
          if (!saved) applyTheme(e.matches ? 'dark' : '');
        });
      }
      loadTheme();

      // Sidebar control + keyboard shortcut (Alt+M) and ESC to close
      function setSidebar(open) {
        sidebar.setAttribute('data-open', String(Boolean(open)));
        sidebarToggleBtn.setAttribute('aria-expanded', String(Boolean(open)));
      }
      function toggleSidebar() {
        const isOpen = sidebar.getAttribute('data-open') === 'true';
        setSidebar(!isOpen);
      }
      sidebarToggleBtn.addEventListener('click', toggleSidebar);
      document.addEventListener('keydown', (e) => {
        if (e.altKey && (e.key === 'm' || e.key === 'M')) {
          e.preventDefault();
          toggleSidebar();
          sidebarToggleBtn.focus();
        }
        if (e.key === 'Escape') {
          const isOpen = sidebar.getAttribute('data-open') === 'true';
          if (isOpen) {
            setSidebar(false);
            sidebarToggleBtn.focus();
          }
        }
      });

      // Input behaviour
      function updateSendState() {
        sendBtn.disabled = !messageInput.value.trim();
      }
      messageInput.addEventListener('input', () => {
        updateSendState();
        // auto-size but respect max height
        messageInput.style.height = 'auto';
        messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
      });

      // Starter cards click
      starterCards.addEventListener('click', (e) => {
        const card = e.target.closest('.starter-card');
        if (card) {
          const question = card.getAttribute('data-question');
          if (question) sendMessage(question);
        }
      });

      // Form submit
      chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (message) sendMessage(message);
      });

      // Accessibility helpers for status
      function announceForAT(message) {
        if (srStatus) {
          srStatus.textContent = message;
        }
      }
      function showVisibleStatus(show, text) {
        if (!botStatusVisible) return;
        if (show) {
          botStatusVisible.style.display = 'inline-block';
          botStatusVisible.textContent = text || 'Bot is generating response…';
        } else {
          botStatusVisible.style.display = 'none';
          botStatusVisible.textContent = '';
        }
      }

      // Message rendering helpers
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function addMessage(text, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;

        if (type === 'user') {
          messageDiv.innerHTML = `<div role="article" aria-roledescription="user message" class="message-bubble">${escapeHtml(text)}</div>`;
        } else if (type === 'assistant') {
          // Accept HTML for assistant content (trusted here because it's your placeholder)
          messageDiv.innerHTML = `<div role="article" aria-roledescription="assistant message" class="message-content">${text}</div>`;
        }

        messagesArea.appendChild(messageDiv);

        // Scroll with respect for reduced-motion preference
        if (prefersReducedMotionMQ.matches) {
          messagesArea.scrollTop = messagesArea.scrollHeight;
        } else {
          // smooth scroll: use element.scrollIntoView for consistency
          messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        return messageDiv;
      }

      // Attach followup handlers inside assistant messages
      function attachFollowups(container) {
        const followupBtns = container.querySelectorAll ? container.querySelectorAll('.followup-btn') : [];
        followupBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const question = btn.getAttribute('data-followup');
            if (question) sendMessage(question);
          });
        });
      }

      // Send message flow
      function sendMessage(text) {
        // hide starter UI
        starterCards.style.display = 'none';
        promptHeader.style.display = 'none';
        messagesArea.setAttribute('data-active', 'true');

        // add user message
        addMessage(text, 'user');

        // clear/resize input
        messageInput.value = '';
        messageInput.style.height = 'auto';
        updateSendState();

        // show visible and SR status
        announceForAT('Bot is generating response...');
        showVisibleStatus(true, 'Bot is generating response…');

        // simulate network/processing delay (same behavior as original but with status)
        setTimeout(() => {
          // original assistant content preserved:
          const assistantHtml = `
            <p>This is a placeholder response. The bot functionality will be implemented in the future. This interface demonstrates the structure for displaying responses with citations and follow-up questions.</p>

            <div class="citations">
              <h3 class="citations-title">Sources</h3>
              <ul class="citations-list">
                <li>
                  <a href="#" class="citation-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                      <path d="M8 1L3 6h3v6h4V6h3L8 1z"/>
                    </svg>
                    Ethics Guidelines Document
                  </a>
                </li>
                <li>
                  <a href="#" class="citation-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                      <path d="M8 1L3 6h3v6h4V6h3L8 1z"/>
                    </svg>
                    Professional Standards Handbook
                  </a>
                </li>
                <li>
                  <a href="#" class="citation-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                      <path d="M8 1L3 6h3v6h4V6h3L8 1z"/>
                    </svg>
                    Case Studies in Ethics
                  </a>
                </li>
              </ul>
            </div>

            <div class="followup-questions">
              <h3 class="followup-title">Related Questions</h3>
              <ul class="followup-list">
                <li>
                  <button class="followup-btn" data-followup="Tell me more about ethical frameworks">
                    Tell me more about ethical frameworks
                  </button>
                </li>
                <li>
                  <button class="followup-btn" data-followup="How do I report ethical violations?">
                    How do I report ethical violations?
                  </button>
                </li>
                <li>
                  <button class="followup-btn" data-followup="What are common ethical dilemmas?">
                    What are common ethical dilemmas?
                  </button>
                </li>
              </ul>
            </div>
          `;

          // hide status
          announceForAT('');
          showVisibleStatus(false);

          // insert assistant message preserving content
          const assistantNode = addMessage(assistantHtml, 'assistant');

          // attach followups inside this assistant node
          attachFollowups(assistantNode);

          // restore focus to composer
          messageInput.focus();
        }, 1000);
      }

      // Initialize
      function init() {
        // ensure ARIA attributes on messages area (explicit)
        messagesArea.setAttribute('aria-live', 'polite');
        messagesArea.setAttribute('aria-atomic', 'false');
        messagesArea.setAttribute('aria-relevant', 'additions text');

        // set initial send button state
        updateSendState();

        // focus composer for keyboard users
        messageInput.focus();

        // Observe new messages for potential future behaviors (e.g. trimming)
        const observer = new MutationObserver((mutations) => {
          // placeholder for future trimming/analytics etc.
        });
        observer.observe(messagesArea, { childList: true, subtree: true });
      }

      init();
    })();
  </script>
</body>
</html>
