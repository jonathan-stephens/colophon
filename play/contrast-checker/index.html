<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Contrast Checker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    const ContrastChecker = () => {
      const [colors, setColors] = useState([
        '#F2E9DF',
        '#CDCDA0',
        '#97AE61',
        '#4C922F',
        '#067D53',
        '#00645A',
        '#0F2933'
      ]);

      // Convert hex to RGB
      const hexToRgb = (hex) => {
        const rgb = parseInt(hex.slice(1), 16);
        return {
          r: (rgb >> 16) & 0xff,
          g: (rgb >> 8) & 0xff,
          b: (rgb >> 0) & 0xff
        };
      };

      // Convert RGB to linear RGB
      const rgbToLinear = (c) => {
        c = c / 255;
        return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
      };

      // Convert linear RGB to RGB
      const linearToRgb = (c) => {
        return c <= 0.0031308 ? c * 12.92 : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;
      };

      // Convert hex to OKLCH
      const hexToOklch = (hex) => {
        const { r, g, b } = hexToRgb(hex);
        const lr = rgbToLinear(r);
        const lg = rgbToLinear(g);
        const lb = rgbToLinear(b);

        // Linear RGB to OKLab
        const l = 0.4122214708 * lr + 0.5363325363 * lg + 0.0514459929 * lb;
        const m = 0.2119034982 * lr + 0.6806995451 * lg + 0.1073969566 * lb;
        const s = 0.0883024619 * lr + 0.2817188376 * lg + 0.6299787005 * lb;

        const l_ = Math.cbrt(l);
        const m_ = Math.cbrt(m);
        const s_ = Math.cbrt(s);

        const L = 0.2104542553 * l_ + 0.7936177850 * m_ - 0.0040720468 * s_;
        const a = 1.9779984951 * l_ - 2.4285922050 * m_ + 0.4505937099 * s_;
        const b_ = 0.0259040371 * l_ + 0.7827717662 * m_ - 0.8086757660 * s_;

        const C = Math.sqrt(a * a + b_ * b_);
        const h = Math.atan2(b_, a) * 180 / Math.PI;

        return {
          l: L,
          c: C,
          h: h < 0 ? h + 360 : h
        };
      };

      // Convert OKLCH to hex
      const oklchToHex = (l, c, h) => {
        const hRad = h * Math.PI / 180;
        const a = c * Math.cos(hRad);
        const b = c * Math.sin(hRad);

        const l_ = l + 0.3963377774 * a + 0.2158037573 * b;
        const m_ = l - 0.1055613458 * a - 0.0638541728 * b;
        const s_ = l - 0.0894841775 * a - 1.2914855480 * b;

        const l3 = l_ * l_ * l_;
        const m3 = m_ * m_ * m_;
        const s3 = s_ * s_ * s_;

        const lr = +4.0767416621 * l3 - 3.3077115913 * m3 + 0.2309699292 * s3;
        const lg = -1.2684380046 * l3 + 2.6097574011 * m3 - 0.3413193965 * s3;
        const lb = -0.0041960863 * l3 - 0.7034186147 * m3 + 1.7076147010 * s3;

        const r = Math.round(Math.max(0, Math.min(255, linearToRgb(lr) * 255)));
        const g = Math.round(Math.max(0, Math.min(255, linearToRgb(lg) * 255)));
        const b_ = Math.round(Math.max(0, Math.min(255, linearToRgb(lb) * 255)));

        return '#' + [r, g, b_].map(x => x.toString(16).padStart(2, '0')).join('');
      };

      // Calculate relative luminance
      const getLuminance = (hex) => {
        const rgb = parseInt(hex.slice(1), 16);
        const r = (rgb >> 16) & 0xff;
        const g = (rgb >> 8) & 0xff;
        const b = (rgb >> 0) & 0xff;

        const [rs, gs, bs] = [r, g, b].map(c => {
          c = c / 255;
          return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
        });

        return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
      };

      // Calculate contrast ratio
      const getContrastRatio = (hex1, hex2) => {
        const lum1 = getLuminance(hex1);
        const lum2 = getLuminance(hex2);
        const lighter = Math.max(lum1, lum2);
        const darker = Math.min(lum1, lum2);
        return (lighter + 0.05) / (darker + 0.05);
      };

      // Get accessibility rating
      const getAccessibilityRating = (ratio) => {
        if (ratio >= 7) return { label: 'AAA', color: 'bg-green-500' };
        if (ratio >= 4.5) return { label: 'AA', color: 'bg-blue-500' };
        if (ratio >= 3) return { label: 'AA18', color: 'bg-yellow-500' };
        return { label: 'DNP', color: 'bg-red-500' };
      };

      // Check if text should be dark or light
      const getTextColor = (bgHex) => {
        const lum = getLuminance(bgHex);
        return lum > 0.5 ? '#000000' : '#FFFFFF';
      };

      const handleColorChange = (index, value) => {
        const newColors = [...colors];
        newColors[index] = value;
        setColors(newColors);
      };

      const handleOklchChange = (index, component, value) => {
        const oklch = hexToOklch(colors[index]);
        oklch[component] = parseFloat(value);
        const newHex = oklchToHex(oklch.l, oklch.c, oklch.h);
        handleColorChange(index, newHex);
      };

      const addColor = () => {
        if (colors.length < 10) {
          setColors([...colors, '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')]);
        }
      };

      const removeColor = (index) => {
        if (colors.length > 2) {
          setColors(colors.filter((_, i) => i !== index));
        }
      };

      return (
        <div className="p-6 max-w-7xl mx-auto bg-gray-50 min-h-screen">
          <div className="mb-8">
            <h1 className="text-3xl font-bold mb-2">Color Palette Contrast Checker</h1>
            <p className="text-gray-600">Add or modify colors to test WCAG contrast ratios</p>
          </div>

          {/* Two Column Layout */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            {/* Color Input Section */}
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Color Palette</h2>
              <div className="space-y-6">
                {colors.map((color, index) => {
                  const oklch = hexToOklch(color);
                  return (
                    <div key={index} className="border border-gray-200 rounded-lg p-4">
                      <div className="flex items-start gap-4">
                        <div className="flex flex-col items-center">
                          <div className="relative">
                            <input
                              type="color"
                              value={color}
                              onChange={(e) => handleColorChange(index, e.target.value)}
                              className="w-16 h-16 rounded cursor-pointer border-2 border-gray-300"
                            />
                            {colors.length > 2 && (
                              <button
                                onClick={() => removeColor(index)}
                                className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold hover:bg-red-600"
                              >
                                ×
                              </button>
                            )}
                          </div>
                          <input
                            type="text"
                            value={color.toUpperCase()}
                            onChange={(e) => {
                              const val = e.target.value;
                              if (/^#[0-9A-Fa-f]{0,6}$/.test(val)) {
                                handleColorChange(index, val);
                              }
                            }}
                            className="mt-2 w-20 text-center text-xs border rounded px-1 py-1"
                          />
                        </div>

                        <div className="flex-1 space-y-2">
                          <div>
                            <label className="text-xs font-medium text-gray-700 flex justify-between">
                              <span>Lightness (L)</span>
                              <span className="text-gray-500">{oklch.l.toFixed(3)}</span>
                            </label>
                            <input
                              type="range"
                              min="0"
                              max="1"
                              step="0.001"
                              value={oklch.l}
                              onChange={(e) => handleOklchChange(index, 'l', e.target.value)}
                              className="w-full"
                            />
                          </div>

                          <div>
                            <label className="text-xs font-medium text-gray-700 flex justify-between">
                              <span>Chroma (C)</span>
                              <span className="text-gray-500">{oklch.c.toFixed(3)}</span>
                            </label>
                            <input
                              type="range"
                              min="0"
                              max="0.4"
                              step="0.001"
                              value={oklch.c}
                              onChange={(e) => handleOklchChange(index, 'c', e.target.value)}
                              className="w-full"
                            />
                          </div>

                          <div>
                            <label className="text-xs font-medium text-gray-700 flex justify-between">
                              <span>Hue (H)</span>
                              <span className="text-gray-500">{oklch.h.toFixed(1)}°</span>
                            </label>
                            <input
                              type="range"
                              min="0"
                              max="360"
                              step="1"
                              value={oklch.h}
                              onChange={(e) => handleOklchChange(index, 'h', e.target.value)}
                              className="w-full"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}

                {colors.length < 10 && (
                  <button
                    onClick={addColor}
                    className="w-full py-2 border-2 border-dashed border-gray-400 rounded-lg text-gray-600 hover:border-gray-600 hover:text-gray-800 font-medium text-sm"
                  >
                    + Add Color
                  </button>
                )}
              </div>
            </div>

            {/* Contrast Grid */}
            <div className="bg-white p-6 rounded-lg shadow overflow-x-auto">
              <h2 className="text-xl font-semibold mb-4">Contrast Matrix</h2>
              <table className="border-collapse">
                <thead>
                  <tr>
                    <th className="border border-gray-300 p-2 bg-gray-100"></th>
                    {colors.map((color, i) => (
                      <th key={i} className="border border-gray-300 p-2" style={{ backgroundColor: color, color: getTextColor(color), minWidth: '100px' }}>
                        <div className="text-xs font-bold">{color.toUpperCase()}</div>
                      </th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {colors.map((bgColor, bgIndex) => (
                    <tr key={bgIndex}>
                      <th className="border border-gray-300 p-2" style={{ backgroundColor: bgColor, color: getTextColor(bgColor), minWidth: '100px' }}>
                        <div className="text-xs font-bold">{bgColor.toUpperCase()}</div>
                      </th>
                      {colors.map((fgColor, fgIndex) => {
                        if (bgIndex === fgIndex) {
                          return (
                            <td key={fgIndex} className="border border-gray-300 bg-gray-200"></td>
                          );
                        }

                        const ratio = getContrastRatio(bgColor, fgColor);
                        const rating = getAccessibilityRating(ratio);

                        return (
                          <td
                            key={fgIndex}
                            className="border border-gray-300 p-3"
                            style={{ backgroundColor: bgColor, color: fgColor }}
                          >
                            <div className="flex flex-col items-center justify-center space-y-1">
                              <div className="text-sm font-medium">Text</div>
                              <div className={`${rating.color} text-white text-xs font-bold px-2 py-1 rounded`}>
                                {rating.label}
                              </div>
                              <div className="text-xs" style={{ color: getTextColor(bgColor) }}>
                                {ratio.toFixed(1)}
                              </div>
                            </div>
                          </td>
                        );
                      })}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Legend */}
          <div className="mt-6 bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-3">WCAG 2.0 Contrast Standards</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="flex items-center">
                <span className="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded mr-2">AAA</span>
                <span className="text-sm">≥7:1 (Enhanced)</span>
              </div>
              <div className="flex items-center">
                <span className="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded mr-2">AA</span>
                <span className="text-sm">≥4.5:1 (Normal text)</span>
              </div>
              <div className="flex items-center">
                <span className="bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded mr-2">AA18</span>
                <span className="text-sm">≥3:1 (Large text)</span>
              </div>
              <div className="flex items-center">
                <span className="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded mr-2">DNP</span>
                <span className="text-sm">&lt;3:1 (Fails)</span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ContrastChecker />);
  </script>
</body>
</html>
