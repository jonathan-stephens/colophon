<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SVG Color Palette Tool v2</title>
<style>
/* Layout and basic styles */
.page-layout { display: grid; grid-template-rows: auto 1fr auto; min-height: 100vh; }
.main-layout { display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; padding: 1rem; }
.left-column { display: grid; grid-template-rows: auto 1fr auto; gap: 1rem; }
.input-section { background: #f9f9f9; padding: 1.5rem; border-radius: 4px; }
.stack > * + * { margin-block-start: 1rem; }
.palette-display { border: 1px solid #ccc; background: #f9f9f9; overflow: auto; padding: 1rem; min-height: 300px; }
.palette-actions { display: flex; gap: 1rem; flex-wrap: wrap; }
.controls { background: #f5f5f5; border-radius: 4px; overflow-y: auto; max-height: calc(100vh - 2rem); }
.input-group > label { display: block; font-weight: bold; margin-bottom: 0.25rem; }
.input-group > input, .input-group > textarea { width: 100%; padding: 0.5rem; border: 1px solid #999; border-radius: 2px; }
.input-group > textarea { resize: vertical; min-height: 80px; font-family: monospace; }
.btn { padding: 0.5rem 1rem; background: #007cba; color: white; border: none; border-radius: 2px; cursor: pointer; font-size: 0.9rem; }
.btn:hover { background: #005a8b; }
.btn:disabled { background: #999; cursor: not-allowed; }
.swatch-editor { border: 1px solid #ddd; padding: 0.75rem; background: white; border-radius: 2px; min-height: 200px; }
.color-row { display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.75rem; }
.color-preview { width: 32px; height: 32px; border: 1px solid #000; flex-shrink: 0; border-radius: 2px; }
.color-info { font-size: 0.75rem; color: #666; font-family: monospace; }
.category-input-wrapper { position: relative; display: flex; align-items: center; }
.category-input-wrapper input { margin-right: 0.5rem; }
.tooltip-dialog { margin: 0; padding: 1rem; border: 1px solid #ccc; border-radius: 4px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 300px; }
.tooltip-dialog::backdrop { background: rgba(0,0,0,0.3); }
.tooltip-dialog h4 { margin-top: 0; margin-bottom: 0.5rem; }
.tooltip-dialog ul { margin: 0; padding-left: 1.2rem; font-size: 0.9rem; }
.tooltip-dialog button { margin-top: 0.5rem; }
.footer { background: #f8f9fa; padding: 2rem; border-top: 1px solid #dee2e6; }
.footer h3 { margin-top: 0; }
@media (max-width: 1024px) { .main-layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; } }
@media (max-width: 768px) { .palette-actions { flex-direction: column; } }
</style>
<script src="https://cdn.jsdelivr.net/npm/colorjs.io/dist/color.min.js"></script>
</head>
<body class="page-layout">
<main class="main-layout">
<section class="left-column">
<div class="input-section stack">
<header><h1>SVG Color Palette Tool v2</h1><p>Upload or paste SVG. Extract fill colors only. Export JSON, SVG, CSV.</p></header>
<div class="input-group">
<label for="file-input">Upload SVG File</label>
<input type="file" id="file-input" accept=".svg,image/svg+xml">
</div>
<div class="input-group">
<label for="svg-input">Or Paste SVG Code</label>
<textarea id="svg-input" placeholder="Paste your SVG code here..."></textarea>
</div>
<button class="btn" id="process-btn">Process Palette</button>
</div>
<div class="palette-display" id="palette-display"><p style="color:#666">Processed palette appears here</p></div>
<div class="palette-actions">
<button class="btn" id="download-svg" disabled>Download SVG</button>
<button class="btn" id="download-json" disabled>Download JSON</button>
<button class="btn" id="download-csv" disabled>Download CSV</button>
</div>
</section>
<aside class="controls" id="swatch-controls">
<h2 style="padding:1rem;background:#e9ecef;margin:0;border-radius:4px 4px 0 0;">Swatch Configuration</h2>
<p style="padding:1rem;color:#666;text-align:center;">Process a palette to configure swatches</p>
</aside>
</main>
<footer class="footer"><h3>Instructions</h3><p>Upload SVG or paste SVG code. Click Process. Configure swatches. Export JSON, SVG, or CSV.</p></footer>
<script>
let currentPalette = null;
let swatchData = [];
const elements = {
  fileInput: document.getElementById('file-input'),
  svgInput: document.getElementById('svg-input'),
  processBtn: document.getElementById('process-btn'),
  paletteDisplay: document.getElementById('palette-display'),
  swatchControls: document.getElementById('swatch-controls'),
  downloadSVG: document.getElementById('download-svg'),
  downloadJSON: document.getElementById('download-json'),
  downloadCSV: document.getElementById('download-csv')
};// Parse CSS rules inside <style> blocks function parseSVGStyles(svg) { const cssText = Array.from(svg.querySelectorAll('style')).map(s=>s.textContent).join('\n'); const rules = []; const regex = /([^{]+){([^}]+)}/g; let match; while(match = regex.exec(cssText)){ const selectors = match[1].trim().split(',').map(s=>s.trim()); const fillMatch = match[2].match(/fill\s*:\s*([^;]+)/i); if(fillMatch) rules.push({selectors, fill: fillMatch[1].trim()}); } return rules; }

function computeFillForElement(el, styleRules){ let fill = el.getAttribute('fill'); if(!fill){ const styleAttr = el.getAttribute('style'); if(styleAttr){ const m = styleAttr.match(/fill\s*:\s*([^;]+)/i); if(m) fill = m[1].trim(); } } if(!fill){ styleRules.forEach(rule=>{ rule.selectors.forEach(sel=>{ if(el.matches(sel)) fill = fill || rule.fill; }); }); } return fill || null; }

function processSVG(svgContent){ const parser = new DOMParser(); const doc = parser.parseFromString(svgContent, 'image/svg+xml'); const svg = doc.documentElement; if(svg.nodeName !== 'svg') throw new Error('Invalid SVG'); const styleRules = parseSVGStyles(svg); const elementsWithFill = svg.querySelectorAll('[fill], [style*="fill"]'); const colors = []; let index = 1; elementsWithFill.forEach(el => { const fill = computeFillForElement(el, styleRules); if(fill && fill.toLowerCase() !== '#ffffff' && fill.toLowerCase() !== 'white'){ const color = new Color(fill); colors.push({ element: el, color: fill, index, id: 'color-'+index, name: 'Color '+index, category: '', hex: color.to('srgb').toString({format:'hex'}), rgb: color.to('srgb').toString({format:'css'}), hsl: color.to('hsl').toString({format:'css'}), oklch: color.to('oklch').toString(), lab: color.to('lab').toString() }); index++; } }); return {svg, colors}; }

function enhanceSVG(svg, swatches){ const clone = svg.cloneNode(true); swatches.forEach((swatch, i) => { const el = clone.querySelectorAll('[fill], [style*="fill"]')[i]; if(!el) return; el.id = swatch.id; el.setAttribute('data-color-hex', swatch.hex); el.setAttribute('data-color-rgb', swatch.rgb); el.setAttribute('data-color-hsl', swatch.hsl); el.setAttribute('data-color-oklch', swatch.oklch); el.setAttribute('data-color-lab', swatch.lab); el.setAttribute('data-color-name', swatch.name); if(swatch.category) el.setAttribute('data-color-category', swatch.category); }); return clone; }

function updatePaletteDisplay(){ if(!currentPalette) return; elements.paletteDisplay.innerHTML=''; const enhanced = enhanceSVG(currentPalette.svg, swatchData); elements.paletteDisplay.appendChild(enhanced); }

function handleFile(file){ if(!file.type.includes('svg')){ alert('Select SVG file'); return; } const reader = new FileReader(); reader.onload = e => { elements.svgInput.value = e.target.result; processInput(); }; reader.readAsText(file); }

function processInput(){ const content = elements.svgInput.value.trim(); if(!content) { alert('SVG content required'); return; } try{ const result = processSVG(content); currentPalette = result; swatchData = result.colors; updatePaletteDisplay(); elements.downloadSVG.disabled = false; elements.downloadJSON.disabled = false; elements.downloadCSV.disabled = false; } catch(e){ alert(e.message); console.error(e); } }

function downloadSVG(){ const enhanced = enhanceSVG(currentPalette.svg, swatchData); const str = new XMLSerializer().serializeToString(enhanced); const blob = new Blob([str], {type:'image/svg+xml'}); const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='palette.svg'; a.click(); }

function downloadJSON(){ const blob = new Blob([JSON.stringify(swatchData,null,2)],{type:'application/json'}); const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='palette.json'; a.click(); }

function downloadCSV(){ let csv='id,name,category,hex,rgb,hsl,oklch,lab\n'; swatchData.forEach(s=>{ csv+="${s.id}","${s.name}","${s.category}","${s.hex}","${s.rgb}","${s.hsl}","${s.oklch}","${s.lab}"\n; }); const blob = new Blob([csv],{type:'text/csv'}); const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='palette.csv'; a.click(); }

// Event listeners elements.fileInput.addEventListener('change', e => { if(e.target.files[0]) handleFile(e.target.files[0]); }); elements.processBtn.addEventListener('click', processInput); elements.downloadSVG.addEventListener('click', downloadSVG); elements.downloadJSON.addEventListener('click', downloadJSON); elements.downloadCSV.addEventListener('click', downloadCSV); </script>

</body>
</html>