const CACHE_NAME="bookmarks-pwa-v6",urlsToCache=["/","/share"];self.addEventListener("install",(e=>{console.log("ðŸ”§ SW v6: Installing"),e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(urlsToCache))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(e=>{console.log("ðŸš€ SW v6: Activating"),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return caches.delete(e)}))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{const{request:t}=e,s=new URL(t.url);if("POST"===t.method&&"/share"===s.pathname)return console.log("ðŸŽ¯ SW v6: Share POST detected"),void e.respondWith((async()=>{try{const e=await t.clone().formData();console.log("ðŸ“¦ SW v6: Raw form data:");for(const[t,s]of e.entries())console.log(`  ${t}: ${s}`);let n=e.get("url")||"",o=e.get("title")||"",a=e.get("text")||"";if(console.log("ðŸ“¦ SW v6: Initial extraction:",{url:n,title:o,text:a}),!n&&a&&(a.startsWith("http://")||a.startsWith("https://"))&&(console.log("ðŸ”§ SW v6: URL found in text field, swapping"),n=a,a=""),!n&&a){const e=a.match(/(https?:\/\/[^\s]+)/);e&&(console.log("ðŸ”§ SW v6: URL extracted from text"),n=e[1],a=a.replace(e[1],"").trim())}console.log("ðŸ“¦ SW v6: After processing:",{url:n,title:o,text:a});const r=new URLSearchParams;n&&r.set("url",n),o&&r.set("title",o),a&&r.set("text",a);const l=`${s.origin}/share?${r.toString()}`;return console.log("âž¡ï¸ SW v6: Redirecting to:",l),Response.redirect(l,303)}catch(e){return console.error("âŒ SW v6: Share handler error:",e),Response.redirect(`${s.origin}/share`,303)}})());"/share"!==s.pathname?s.pathname.startsWith("/api/")?e.respondWith(fetch(t)):e.respondWith(fetch(t).then((e=>{if(e&&200===e.status&&"GET"===t.method&&"basic"===e.type){const s=e.clone();caches.open(CACHE_NAME).then((e=>{e.put(t,s)}))}return e})).catch((()=>caches.match(t)))):e.respondWith(fetch(t))})),self.addEventListener("message",(e=>{e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting()})),console.log("âœ… SW v6 loaded");